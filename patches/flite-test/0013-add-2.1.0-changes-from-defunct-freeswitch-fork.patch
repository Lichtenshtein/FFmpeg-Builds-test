From fd963e6d39ed329e90b542b65bd9987822f86fbe Mon Sep 17 00:00:00 2001
From: Daniel Finke <danielfinke2011@gmail.com>
Date: Wed, 18 Feb 2026 12:28:23 -0800
Subject: [PATCH] add 2.1.0 changes from defunct FreeSWITCH fork

- [PATCH] auserver.c: Only write audio data to a file in debug builds
- rpmbuild script
- flite pkgconfig
- Fedora RPM spec
- src tarball script

defunct fork: https://freeswitch.org/stash/scm/sd/libflite.git
---
 ...write-audio-data-to-a-file-in-debug-.patch |  50 +++++
 Makefile                                      |   2 +
 build_rpm.sh                                  |  20 ++
 configure                                     |   3 +-
 configure.in                                  |   2 +-
 flite.pc.in                                   |  12 ++
 flite.spec                                    | 175 ++++++++++++++++++
 src_tarball.sh                                |  14 ++
 8 files changed, 276 insertions(+), 2 deletions(-)
 create mode 100644 0001-auserver.c-Only-write-audio-data-to-a-file-in-debug-.patch
 create mode 100755 build_rpm.sh
 create mode 100644 flite.pc.in
 create mode 100644 flite.spec
 create mode 100755 src_tarball.sh

diff --git a/build_rpm.sh b/build_rpm.sh
new file mode 100755
index 0000000..d1a20f4
--- /dev/null
+++ b/build_rpm.sh
@@ -0,0 +1,20 @@
+#/bin/bash
+BUILDMODE=$1 # ALL or SRPM
+RPMBUILDMODE="-ba" # "-ba" for ALL, "-bs" for SRPM
+
+if [ "$BUILDMODE" == "SRPM" ]; then
+    RPMBUILDMODE="-bs"
+fi
+
+ORIGDIR=`pwd`
+cd ..
+(mkdir -p rpmbuild && cd rpmbuild && mkdir -p SOURCES BUILD BUILDROOT i386 x86_64 SPECS)
+
+cp ${ORIGDIR}/*.spec rpmbuild/SPECS/.
+cp ${ORIGDIR}/*.gz rpmbuild/SOURCES/.
+cp ${ORIGDIR}/*.patch rpmbuild/SOURCES/.
+
+rpmbuild --define "_topdir %(pwd)/rpmbuild" \
+  --define "_rpmdir %{_topdir}" \
+  --define "_srcrpmdir %{_topdir}" \
+  $RPMBUILDMODE rpmbuild/SPECS/flite.spec
diff --git a/configure b/configure
index 5b8a1b6..24b2b22 100755
--- a/configure
+++ b/configure
@@ -4473,7 +4473,7 @@ fi
 
 
 
-ac_config_files="$ac_config_files config/config config/system.mak"
+ac_config_files="$ac_config_files config/config config/system.mak flite.pc"
 
 cat >confcache <<\_ACEOF
 # This file is a shell script that caches the results of configure
@@ -5476,6 +5476,7 @@ do
   case $ac_config_target in
     "config/config") CONFIG_FILES="$CONFIG_FILES config/config" ;;
     "config/system.mak") CONFIG_FILES="$CONFIG_FILES config/system.mak" ;;
+    "flite.pc") CONFIG_FILES="$CONFIG_FILES flite.pc" ;;
 
   *) as_fn_error $? "invalid argument: '$ac_config_target'" "$LINENO" 5;;
   esac
diff --git a/flite.spec b/flite.spec
new file mode 100644
index 0000000..82d58e1
--- /dev/null
+++ b/flite.spec
@@ -0,0 +1,174 @@
+Name:           flite
+Version:        2.3.0
+Release:        1%{?dist}
+Summary:        Small, fast speech synthesis engine (text-to-speech)
+
+Group:          Applications/Multimedia
+License:        MIT
+URL:            http://www.speech.cs.cmu.edu/flite/
+Source0:        http://www.speech.cs.cmu.edu/flite/packed/%{name}-%{version}/%{name}-%{version}.tar.gz
+BuildRoot:      %{_tmppath}/%{name}-%{version}-%{release}-root-%(%{__id_u} -n)
+
+%if 0%{?el4}
+# there is no texi2html for RHEL 4
+%else
+BuildRequires:  texi2html
+%endif
+BuildRequires:  ed alsa-lib-devel autoconf
+
+
+%description
+Flite (festival-lite) is a small, fast run-time speech synthesis engine
+developed at CMU and primarily designed for small embedded machines and/or
+large servers. Flite is designed as an alternative synthesis engine to
+Festival for voices built using the FestVox suite of voice building tools.
+
+
+%package devel
+Summary: Development files for flite
+Group: Development/Libraries
+Requires: flite = %{version}-%{release}
+
+
+%description devel
+Development files for Flite, a small, fast speech synthesis engine.
+
+
+%prep
+%setup -q -n %{name}-%{version}
+%patch4 -p1
+
+
+%build
+autoconf
+%configure --enable-shared --with-audio=none
+# This package fails parallel make (thus cannot be built using "_smp_flags")
+make
+# Build documentation
+%if 0%{?el4}
+# there is no texi2html for RHEL 4
+%else
+cd doc
+make flite.html
+%endif
+
+
+%install
+rm -rf %{buildroot}
+make install INSTALLBINDIR=%{buildroot}%{_bindir} INSTALLLIBDIR=%{buildroot}%{_libdir}  INSTALLINCDIR=%{buildroot}%{_includedir}/flite
+rm -rf %{buildroot}%{_libdir}/*.a
+
+
+%clean
+rm -rf %{buildroot}
+
+
+%post -p /sbin/ldconfig
+
+
+%postun -p /sbin/ldconfig
+
+
+%files
+%defattr(-,root,root,-)
+%if 0%{?el4}
+# there is no texi2html for RHEL 4
+%doc ACKNOWLEDGEMENTS README.md COPYING README-ALSA.txt
+%else
+%doc ACKNOWLEDGEMENTS README.md COPYING doc/html
+%endif
+%{_libdir}/*.so.*
+%{_bindir}/*
+
+
+%files devel
+%defattr(-,root,root)
+%{_libdir}/*.so
+%{_includedir}/flite
+%{_libdir}/pkgconfig/flite.pc
+
+%changelog
+* Sat Aug 16 2014 Fedora Release Engineering <rel-eng@lists.fedoraproject.org> - 1.3-23
+- Rebuilt for https://fedoraproject.org/wiki/Fedora_21_22_Mass_Rebuild
+
+* Sat Jun 07 2014 Fedora Release Engineering <rel-eng@lists.fedoraproject.org> - 1.3-22
+- Rebuilt for https://fedoraproject.org/wiki/Fedora_21_Mass_Rebuild
+
+* Mon Jan  6 2014 Rui Matos <rmatos@redhat.com> - 1.3-21
+- Resolves: (CVE-2014-0027) flite: insecure temporary file use
+
+* Sat Aug 03 2013 Fedora Release Engineering <rel-eng@lists.fedoraproject.org> - 1.3-20
+- Rebuilt for https://fedoraproject.org/wiki/Fedora_20_Mass_Rebuild
+
+* Wed Feb 13 2013 Fedora Release Engineering <rel-eng@lists.fedoraproject.org> - 1.3-19
+- Rebuilt for https://fedoraproject.org/wiki/Fedora_19_Mass_Rebuild
+
+* Thu Jul 19 2012 Fedora Release Engineering <rel-eng@lists.fedoraproject.org> - 1.3-18
+- Rebuilt for https://fedoraproject.org/wiki/Fedora_18_Mass_Rebuild
+
+* Fri Jan 13 2012 Fedora Release Engineering <rel-eng@lists.fedoraproject.org> - 1.3-17
+- Rebuilt for https://fedoraproject.org/wiki/Fedora_17_Mass_Rebuild
+
+* Mon Mar 14 2011 Francois Aucamp <faucamp@fedoraproject.org> - 1.3-16
+- Added patch declaring explicit libm linking dependency (RHBZ #564899)
+- Updated source and URL tags
+
+* Tue Feb 08 2011 Fedora Release Engineering <rel-eng@lists.fedoraproject.org> - 1.3-15
+- Rebuilt for https://fedoraproject.org/wiki/Fedora_15_Mass_Rebuild
+
+* Fri Jul 24 2009 Fedora Release Engineering <rel-eng@lists.fedoraproject.org> - 1.3-14
+- Rebuilt for https://fedoraproject.org/wiki/Fedora_12_Mass_Rebuild
+
+* Sat Mar 21 2009 Robert Scheck <robert@fedoraproject.org> - 1.3-13
+- Removed moving of non-existing documentation flite directory
+
+* Tue Feb 24 2009 Fedora Release Engineering <rel-eng@lists.fedoraproject.org> - 1.3-12
+- Rebuilt for https://fedoraproject.org/wiki/Fedora_11_Mass_Rebuild
+
+* Sat Oct 11 2008 Peter Lemenkov <lemenkov@gmail.com> - 1.3-11
+- Fix for RHEL 4
+ 
+* Fri Jul 18 2008 Tom "spot" Callaway <tcallawa@redhat.com> - 1.3-10
+- fix license tag
+
+* Mon Feb 18 2008 Fedora Release Engineering <rel-eng@fedoraproject.org> - 1.3-9
+- Autorebuild for GCC 4.3
+
+* Tue Nov 14 2006 Francois Aucamp <faucamp@csir.co.za> - 1.3-8
+- Added comment to %%build stating why "_smp_flags" isn't used with make
+
+* Mon Nov 13 2006 Francois Aucamp <faucamp@csir.co.za> - 1.3-7
+- Modified alsa support patch file to patch "configure.in" instead of "configure"
+- Added "autoconf" step to %%build
+- Added BuildRequires: autoconf
+- Fixed patch backup file suffixes
+- Renamed patch files to a more standard format
+- Moved header files from /usr/include to /usr/include/flite
+- Added -p option to all cp operations (to preserve timestamps)
+
+* Sun Nov 12 2006 Francois Aucamp <faucamp@csir.co.za> - 1.3-6
+- Recreated patch to allow shared libraries to build correctly (sharedlibs.patch)
+- "flite" and "flite_time" binaries now link to flite shared libraries (sharedlibs.patch)
+- Simplified the documentation patch filename
+- Modified patch steps in %%prep to create backup files with different suffixes
+- Removed "_smp_flags" macro from %%build for all archs
+
+* Fri Oct 20 2006 Francois Aucamp <faucamp@csir.co.za> - 1.3-5
+- Modified "build" so that "_smp_flags" is only used for i386 arch
+
+* Tue Oct 10 2006 Francois Aucamp <faucamp@csir.co.za> - 1.3-4
+- Removed "_smp_flags" macro from "build" for x86_64 arch
+
+* Tue Sep 26 2006 Francois Aucamp <faucamp@csir.co.za> - 1.3-3
+- Added README-ALSA.txt (Source1)
+- Removed subpackage: flite-devel-static
+- Modified shared libraries patch (Patch0) to prevent building static libraries
+- Renamed patch files: Patch0, Patch1
+
+* Tue Sep 26 2006 Francois Aucamp <faucamp@csir.co.za> - 1.3-2
+- Added flite 1.3 ALSA patch (Patch2) by Lukas Loehrer - thanks Anthony Green for pointing it out
+- Added configure option: --with-audio=alsa
+- Added BuildRequires: alsa-lib-devel
+
+* Fri Sep 22 2006 Francois Aucamp <faucamp@csir.co.za> - 1.3-1
+- Initial RPM build
diff --git a/src_tarball.sh b/src_tarball.sh
new file mode 100755
index 0000000..9b7f0fe
--- /dev/null
+++ b/src_tarball.sh
@@ -0,0 +1,14 @@
+#!/bin/bash
+ORIGDIR=`pwd`
+TMPDIR=flite.$$
+
+mkdir -p ../${TMPDIR}
+
+cd ..
+cp -a flite ${TMPDIR}/flite-2.1.0
+cd ${TMPDIR}
+rm -rf flite-2.1.0/.git*
+tar zcvf flite-2.1.0.tar.gz flite-2.1.0
+mv flite-2.1.0.tar.gz ${ORIGDIR}/.
+cd ${ORIGDIR}
+rm -rf ../${TMPDIR}
